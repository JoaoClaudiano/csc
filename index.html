<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cear√° SC na S√©rie B 2026 - Mapa de Jogos</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/pt/6/6a/Cear%C3%A1_Sporting_Club_logo.svg" />
</head>
<body>

    <header>
        <h1>‚öΩ <strong>Cear√° Sporting Club</strong> | Brasileir√£o S√©rie B 2026</h1>
    </header>

    <div id="controles">
        <button onclick="carregarJogos()" id="btnAtualizar">üîÑ Atualizar Jogos</button>
        <span style="color:#003366; font-weight:500;">üó∫Ô∏è 38 rodadas</span>
    </div>

    <div id="map"></div>

    <div class="loading" id="loading">Carregando jogos</div>

    <footer>
        <p>üóìÔ∏è Acompanhe a campanha do Vov√¥ no mapa. Dados baseados na tabela b√°sica da CBF [citation:1][citation:3].</p>
    </footer>

    <script src="estadios.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Configura√ß√£o inicial do mapa
        const map = L.map('map').setView([-15.788, -47.879], 4);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let marcadoresAtuais = [];

        function getCorResultado(jogo) {
            if (jogo.resultado === "A definir") return '#6c757d';
            
            const partes = jogo.resultado.split(' x ');
            if (partes.length !== 2) return '#6c757d';
            
            const golsCeara = parseInt(partes[0].replace('Cear√° ', ''));
            const golsAdv = parseInt(partes[1]);
            
            if (isNaN(golsCeara) || isNaN(golsAdv)) return '#6c757d';
            if (golsCeara > golsAdv) return '#28a745';
            if (golsCeara < golsAdv) return '#dc3545';
            return '#ffc107';
        }

        function criarIcone(cor) {
            return L.divIcon({
                html: `<div style="background-color: ${cor}; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 3px 8px rgba(0,0,0,0.4);"></div>`,
                iconSize: [24, 24],
                popupAnchor: [0, -15],
                className: 'marcador-ceara'
            });
        }

        async function carregarJogos() {
            document.getElementById('loading').style.display = 'block';
            marcadoresAtuais.forEach(m => map.removeLayer(m));
            marcadoresAtuais = [];
            
            try {
                // AGORA CARREGAMOS O ARQUIVO CORRETO: jogos-serieb.json
                const response = await fetch('jogos-serieb.json');
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}. Verifique se o arquivo 'jogos-serieb.json' existe.`);
                }
                const jogos = await response.json();
                
                const grupoMarcadores = [];
                
                jogos.forEach(jogo => {
                    const coords = estadios[jogo.estadio];
                    if (!coords) {
                        console.warn(`Est√°dio n√£o encontrado: "${jogo.estadio}" - jogo contra ${jogo.adversario} n√£o ser√° exibido.`);
                        return;
                    }
                    
                    const cor = getCorResultado(jogo);
                    const icone = criarIcone(cor);
                    
                    const popupContent = `
                        <div style="font-family: 'Segoe UI', sans-serif;">
                            <h3 style="margin:0 0 8px 0; color:#003366; border-bottom:2px solid #003366; padding-bottom:4px;">
                                ‚öΩ Cear√° x ${jogo.adversario}
                            </h3>
                            <p style="margin:4px 0;"><strong>üìÖ Data:</strong> ${jogo.data} ${jogo.horario ? '√†s ' + jogo.horario : ''}</p>
                            <p style="margin:4px 0;"><strong>üèüÔ∏è Est√°dio:</strong> ${jogo.estadio}</p>
                            <p style="margin:4px 0;"><strong>üì∫ Transmiss√£o:</strong> ${jogo.transmissao || 'A definir'}</p>
                            <p style="margin:8px 0 0 0; font-size:1.2em; font-weight:bold; color:${cor};">
                                ${jogo.resultado}
                            </p>
                        </div>
                    `;
                    
                    const marcador = L.marker(coords, { icon: icone })
                        .bindPopup(popupContent, { maxWidth: 260 });
                    
                    marcador.addTo(map);
                    marcadoresAtuais.push(marcador);
                    grupoMarcadores.push(marcador);
                });
                
                if (grupoMarcadores.length > 0) {
                    const group = L.featureGroup(grupoMarcadores);
                    map.fitBounds(group.getBounds().pad(0.15));
                }
                
                if (!window.legendaAdicionada) {
                    const legend = L.control({ position: 'bottomright' });
                    legend.onAdd = function() {
                        const div = L.DomUtil.create('div', 'legenda');
                        div.innerHTML = `
                            <div><i style="background:#28a745;"></i> Vit√≥ria do Cear√°</div>
                            <div><i style="background:#dc3545;"></i> Derrota do Cear√°</div>
                            <div><i style="background:#ffc107;"></i> Empate</div>
                            <div><i style="background:#6c757d;"></i> Jogo futuro</div>
                        `;
                        return div;
                    };
                    legend.addTo(map);
                    window.legendaAdicionada = true;
                }
                
            } catch (error) {
                console.error('Erro ao carregar jogos:', error);
                alert('N√£o foi poss√≠vel carregar os jogos. Verifique se o arquivo "jogos-serieb.json" existe e est√° acess√≠vel.');
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        window.addEventListener('load', carregarJogos);
    </script>
</body>
</html>
