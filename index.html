<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Jogos - Cear√° SC 2026</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100%; }
        #controles {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .legenda {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            line-height: 1.5;
        }
        .legenda i {
            display: inline-block;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .atualizar-btn {
            background: #003366;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .atualizar-btn:hover {
            background: #004488;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
        }
    </style>
</head>
<body>
    <div id="controles">
        <button class="atualizar-btn" onclick="carregarJogos()">üîÑ Atualizar Dados</button>
    </div>
    <div id="map"></div>
    <div class="loading" id="loading">Carregando jogos...</div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Banco de dados de est√°dios (pode ser expandido)
        const estadios = {
            "Arena Castel√£o": [-3.806, -38.526],
            "Est√°dio Mois√©s Lucarelli": [-22.912, -47.050],
            "Ilha do Retiro": [-8.063, -34.871],
            "Arena Fonte Nova": [-12.978, -38.504],
            "Est√°dio Independ√™ncia": [-19.912, -43.918],
            "Arena da Amaz√¥nia": [-3.083, -60.028],
            "Est√°dio Serra Dourada": [-16.698, -49.236],
            "Arena Pantanal": [-15.606, -56.116],
            "Est√°dio Heriberto H√ºlse": [-28.716, -49.424],
            "Est√°dio Orlando Scarpelli": [-27.585, -48.566],
            "Est√°dio Presidente Vargas": [-3.745, -38.537],
            "Est√°dio Romeir√£o": [-6.439, -39.304],
            "Est√°dio Doming√£o": [-12.954, -38.392]
        };

        // Inicializar mapa
        const map = L.map('map').setView([-15.788, -47.879], 4);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Vari√°vel para armazenar os marcadores atuais
        let marcadoresAtuais = [];

        // Fun√ß√£o para determinar cor baseada no resultado
        function getCorResultado(jogo) {
            if (jogo.resultado === "A definir") return '#6c757d'; // cinza
            
            // Extrair gols do Cear√° (formato: "Cear√° X x Y Advers√°rio")
            const partes = jogo.resultado.split(' x ');
            if (partes.length !== 2) return '#6c757d';
            
            const golsCeara = parseInt(partes[0].replace('Cear√° ', ''));
            const golsAdv = parseInt(partes[1]);
            
            if (isNaN(golsCeara) || isNaN(golsAdv)) return '#6c757d';
            if (golsCeara > golsAdv) return '#28a745'; // verde (vit√≥ria)
            if (golsCeara < golsAdv) return '#dc3545'; // vermelho (derrota)
            return '#ffc107'; // amarelo (empate)
        }

        // Fun√ß√£o para criar √≠cone colorido
        function criarIcone(cor) {
            return L.divIcon({
                html: `<div style="background-color: ${cor}; width: 22px; height: 22px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>`,
                iconSize: [22, 22],
                popupAnchor: [0, -15],
                className: 'marcador-personalizado'
            });
        }

        // Fun√ß√£o principal para carregar e exibir jogos
        async function carregarJogos() {
            // Mostrar indicador de carregamento
            document.getElementById('loading').style.display = 'block';
            
            // Limpar marcadores antigos
            marcadoresAtuais.forEach(m => map.removeLayer(m));
            marcadoresAtuais = [];
            
            try {
                // Carregar dados do arquivo JSON
                const response = await fetch('jogos.json');
                const jogos = await response.json();
                
                // Array para guardar os marcadores (para ajuste de zoom)
                const markers = [];
                
                // Processar cada jogo
                jogos.forEach(jogo => {
                    // Buscar coordenadas do est√°dio
                    const coords = estadios[jogo.estadio];
                    
                    if (!coords) {
                        console.warn(`Est√°dio n√£o encontrado: ${jogo.estadio}`);
                        return;
                    }
                    
                    // Determinar cor do marcador
                    const cor = getCorResultado(jogo);
                    const icone = criarIcone(cor);
                    
                    // Criar popup com informa√ß√µes detalhadas
                    const popupContent = `
                        <div style="min-width: 200px;">
                            <h3 style="margin: 0 0 5px 0; color: #003366;">‚öΩ Cear√° x ${jogo.adversario}</h3>
                            <p style="margin: 3px 0;"><strong>üìÖ Data:</strong> ${jogo.data} ${jogo.horario ? '√†s ' + jogo.horario : ''}</p>
                            <p style="margin: 3px 0;"><strong>üèüÔ∏è Local:</strong> ${jogo.estadio}</p>
                            <p style="margin: 3px 0;"><strong>üèÜ Competi√ß√£o:</strong> ${jogo.competicao || 'N√£o informada'}</p>
                            <p style="margin: 3px 0;"><strong>üì∫ Transmiss√£o:</strong> ${jogo.transmissao || 'A definir'}</p>
                            <p style="margin: 8px 0 0 0; font-size: 1.2em; font-weight: bold; color: ${cor};">
                                ${jogo.resultado}
                            </p>
                        </div>
                    `;
                    
                    // Criar e adicionar marcador
                    const marcador = L.marker(coords, { icon: icone })
                        .bindPopup(popupContent);
                    
                    marcador.addTo(map);
                    marcadoresAtuais.push(marcador);
                    markers.push(marcador);
                });
                
                // Ajustar zoom para mostrar todos os marcadores
                if (markers.length > 0) {
                    const group = L.featureGroup(markers);
                    map.fitBounds(group.getBounds().pad(0.2));
                }
                
                // Adicionar legenda (se n√£o existir)
                if (!document.querySelector('.legenda')) {
                    const legend = L.control({ position: 'bottomright' });
                    legend.onAdd = function() {
                        const div = L.DomUtil.create('div', 'legenda');
                        div.innerHTML = `
                            <div><i style="background:#28a745;"></i> Vit√≥ria</div>
                            <div><i style="background:#dc3545;"></i> Derrota</div>
                            <div><i style="background:#ffc107;"></i> Empate</div>
                            <div><i style="background:#6c757d;"></i> Futuro</div>
                        `;
                        return div;
                    };
                    legend.addTo(map);
                }
                
            } catch (error) {
                console.error('Erro ao carregar jogos:', error);
                alert('Erro ao carregar os dados dos jogos. Verifique se o arquivo jogos.json existe.');
            } finally {
                // Esconder indicador de carregamento
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Carregar jogos automaticamente ao abrir a p√°gina
        carregarJogos();
    </script>
</body>
</html>
